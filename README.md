# KIMPVIEW
> 🟢 Stable Version: v1.0.0 <br>
> 🔗 **Live Service**: https://kimpview.com<br>
> ✍️ **Dev Blog**: https://velog.io/@cokid7979 <br>
> 📊 Kimchi Premium Real-time Dashboard  
> 🚀 Vanilla JS + Cloudflare Worker 기반 실서비스 운영 중

![KIMPVIEW Main Screenshot](/images/main.png)

## 🔑 Key Achievement

- **실제 서비스 운영 기준 누적 방문자 30,000+ 기록**
- **Google / Naver 검색 결과 상위 노출 확인**

---

## 📌 프로젝트 목적

- 거래소별 가격 차이를 한눈에 확인할 수 있는 화면 구성
- 프론트엔드 구조 설계 및 실시간 데이터 가공 로직 구현
- 단순 UI 구현이 아닌, **실사용을 고려한 화면 흐름 설계**

---

## ✨ 주요 기능

- Upbit / Bithumb 기준 원화 가격 테이블 제공
- Binance(USDT) 기준 가격을 환율로 환산하여 비교
- 김치프리미엄(%) 및 가격 차이(KRW) 자동 계산
- 즐겨찾기 / 검색 / 정렬(컬럼별) 지원
- 데이터 로딩 실패 시에도 화면이 깨지지 않도록 캐시 기반 fallback 렌더링 적용
- 실시간성 강화를 위해 **주기적 갱신 기반(Short TTL)** 데이터 업데이트 적용

---

## 🧩 구현/설계 포인트

- **UI 렌더링과 데이터 가공 로직 분리**
  - state 기반으로 필터/정렬/즐겨찾기 반영 후 렌더링
- **중복 API 호출 방지 및 체감 속도 개선**
  - localStorage 캐시(SWR 형태)로 초기 화면을 즉시 표시 후 백그라운드 갱신
  - 데이터 종류별 TTL 분리(가격/환율/시총/뉴스 등)
- **외부 API 제약(CORS/KEY 노출) 대응**
  - 프록시 서버(Cloudflare Worker)를 통해 외부 API 호출을 중계
- **에러/빈값 처리**
  - 값이 없을 때는 “-” 대신 빈칸 처리
  - 응답 지연/실패 시에도 테이블 구조가 유지되도록 방어 코드 적용  
    → 외부 API 상태와 무관하게 UI 안정성 확보

---
## 🔄 Data Flow & Caching Strategy

> 페이지 진입 시 캐시 데이터를 즉시 렌더링하고,  
> 백그라운드에서 최신 데이터를 갱신하는  
> **SWR(Stale-While-Revalidate) 기반 데이터 흐름**

![KIMPVIEW Data Flow & Caching Strategy](/images/data_flow_caching_strategy.png)

## 🛠 기술 스택

### Frontend

- Vanilla JavaScript (ES6+, State-based UI Rendering)
- CSS3 (Flexbox / Grid)
- Performance Optimization (`IntersectionObserver`)  
  → 대규모 실시간 테이블 DOM 업데이트 최적화를 위해 사용
- WebSocket API (Real-time Liquidation & Trade Alerts)
### Infra

- Cloudflare Workers (API Proxy / CORS / API Key 보호)
- localStorage Cache (SWR Pattern implementation)

## 📡 Data Sources

### 🔹 Cryptocurrency Exchange APIs

- **Upbit Open API** – 국내 거래소 암호화폐 시세 (KRW 기준)
- **Bithumb Open API** – 국내 거래소 암호화폐 시세 (KRW 기준)
- **Binance Public API** – 글로벌 거래소 암호화폐 시세 (USDT 기준) 및 **WebSocket** 기반 실시간 선물 체결/청산 데이터
- **CoinPaprika API** – 글로벌 암호화폐 메타데이터 및 시가총액 정보
### 🔹 Market & Financial Data APIs

- **Yahoo Finance API** – 글로벌 주식 지수 및 시장 정보

### 🔹 Crypto News & Alert APIs

- **Naver API** – 국내 경제 지표 및 금융 뉴스
- **CoinNess API** – 암호화폐 속보 및 시장 알림 데이터

## 🏗 시스템 아키텍처

![KIMPVIEW System Architecture](/images/system_architecture.png)


---

## 📁 Project Structure

```text
KIMPVIEW/
├─ index.html
├─ style.css
├─ /html                         # 정적 서브 페이지
│  ├─ stats.html
│  ├─ stocks.html
│  ├─ news.html
│  ├─ fx.html
│  └─ ...
│
├─ /js
│  ├─ app.js                     # 메인 코인 테이블 + LIVE 김프 계산
│  │
│  ├─ /features                  # 기능 모듈
│  │  ├─ fx.js                   # 환율 관련 로직
│  │  ├─ news.js                 # 뉴스 페이지 로직
│  │  ├─ sidepanel.js            # 거래/청산 알림
│  │  ├─ stats.js                # 글로벌 지표
│  │  ├─ stocks.js               # 주식 페이지
│  │  ├─ topmetrics.js           # 상단 실시간 지표
│  │  └─ tv-init.js              # TradingView 초기화
│  │
│  ├─ /calculators               # 종합 계산기 로직
│  │  ├─ avg-cost.js
│  │  ├─ calculator-menu.js
│  │  ├─ lossRecoveryCalc.js
│  │  └─ profitCalc.js
│  │
│  └─ /workers                   # Cloudflare Worker 프록시 코드
│     ├─ worker.js
│     └─ newsworker.js
│
├─ /images
├─ ads.txt
├─ robots.txt
├─ sitemap.xml
└─ README.md

```
> 기능 단위로 JS 모듈을 분리하여 유지보수성과 확장성을 고려한 구조로 설계했습니다.  
> `/workers` 디렉터리는 Cloudflare Worker 배포용 코드로, 외부 API 프록시 및 CORS/보안 처리를 담당합니다.


## 🧪 트러블슈팅

### 🧠 트러블슈팅 요약 (문제 유형별 정리)

> 아래 번호는 하단의 상세 트러블슈팅 항목과 대응됩니다.

- **성능 및 UX 최적화**  
  (1, 4, 6, 10)  
  SWR(Stale-While-Revalidate) 캐싱, <br>       `IntersectionObserver` 기반 부분 렌더링,  
  불필요한 DOM 업데이트 제거 및  
  거래소 전환 시 LIVE 재계산 방식 적용을 통해  
  초기 로딩 속도 및 실시간 UI 갱신 안정성 개선

- **안정성 및 운영 이슈 대응**  
  (2, 5, 9)  
  데이터 성격별 TTL 캐싱 전략 적용 및  
  API 장애 시 이전 데이터 fallback 렌더링을 통해  
  서비스 중단 없는 안정적인 화면 유지   
  브라우저 저장소 버전 관리 도입을 통해  
  기존 사용자 환경 충돌 문제를 자동 복구 구조로 개선

- **보안 및 아키텍처 설계**  
  (3, 8)  
  Cloudflare Worker 기반 API Proxy를 통한  
  CORS 및 API Key 보호,  
  사이드 패널 로직 모듈화 및 `sessionStorage`를 활용한  
  페이지 이동 간 상태 유지

- **UI/UX 디테일 개선**  
  (7)  
  실시간 거래/청산 알림 최대 표시 개수 제한 및  
  매수/매도 유형별 색상 구분을 통해  
  알림 영역 가독성 향상

### 1. 페이지 초기 로딩 시 화면이 비어 보이는 문제

- **문제**  
  외부 거래소 API 응답을 기다린 후에만 테이블을 렌더링하면서,  
  페이지 진입 시 짧은 시간 동안 화면이 비어 보이는 현상이 발생함.
- **원인**  
  초기 렌더링이 실시간 API 응답에 직접 의존하고 있었고,  
  네트워크 지연 시 UX가 크게 저하됨.
- **해결**  
  localStorage에 저장된 기존 데이터를 먼저 렌더링한 뒤,  
  백그라운드에서 최신 데이터를 갱신하는  
  SWR(Stale-While-Revalidate) 형태로 구조를 변경함.
- **결과**  
  페이지 진입 즉시 데이터가 표시되어 체감 로딩 속도가 70% 개선되었고,  
  네트워크 상태와 무관하게 안정적인 초기 화면을 제공할 수 있게 됨.

---

### 2. 무료 API 크레딧 소모 및 호출 제한 문제

- **문제**  
  여러 거래소 및 지표 API를 동시에 호출하면서  
  무료 API 크레딧 소모가 빠르고 호출 제한(429/502)에 자주 도달함.
- **원인**  
  데이터 특성에 관계없이 동일한 주기로 API를 호출하고 있었으며,  
  동일 데이터에 대한 중복 요청이 발생하고 있었음.
- **해결**  
  데이터 성격에 따라 TTL을 분리한 캐싱 전략을 적용함.  
  - 가격 데이터: 짧은 TTL (실시간성 우선)  
  - 환율 / 시총 / 지표 데이터: 긴 TTL (정확성 우선)  
  또한 캐시된 데이터는 즉시 재사용하고,  
  백그라운드에서만 갱신하도록 구조를 개선함.
- **결과**  
  API 호출 횟수를 크게 줄이면서도 체감 실시간성은 유지할 수 있었고,  
  무료 크레딧 범위 내에서 안정적인 서비스 운영이 가능해짐.

---

### 3. 브라우저 CORS 정책으로 인한 외부 API 직접 호출 문제

- **문제**  
  브라우저 환경에서 외부 거래소 API를 직접 호출할 경우  
  CORS 정책으로 인해 요청이 차단되는 문제가 발생함.
- **원인**  
  다수의 외부 API가 브라우저 직접 호출을 허용하지 않으며,  
  API Key 노출 위험이 있는 구조였음.
- **해결**  
  Cloudflare Worker를 프록시 서버로 사용하여  
  외부 API 요청을 서버 단에서 중계하고,  
  CORS 헤더 설정 및 API Key를 안전하게 관리하도록 구조를 변경함.
- **결과**  
  브라우저 환경에서도 안정적인 API 통신이 가능해졌고,  
  보안 및 확장성을 고려한 백엔드 구조의 필요성을 명확히 인식하게 됨.
---
### 4. 대량 데이터 실시간 갱신으로 인한 스크롤 지연 문제

- **문제**  
  실시간 가격 테이블에서 약 300~400개의 행을  
  3초 주기로 전체 DOM 업데이트하면서  
  스크롤 지연 및 브라우저 렌더링 성능 저하가 발생함.

- **원인**  
  화면에 보이지 않는 행까지 포함하여  
  모든 테이블 행을 주기적으로 갱신하는 구조로 인해  
  불필요한 DOM 업데이트가 반복적으로 발생함.

- **해결**  
  `IntersectionObserver`를 활용하여  
  화면에 실제로 노출된 행만 갱신하도록 로직을 변경함.  
  보이지 않는 행은 업데이트 대상에서 제외하여  
  DOM 작업 범위를 최소화함.

- **결과**  
  DOM 업데이트 작업량이 **90% 이상 감소**하였고,  
  스크롤 지연 없이 안정적인 실시간 테이블 렌더링이 가능해짐.

---

### 5. 거래소 점검 시 API 차단으로 테이블이 생성되지 않는 문제

- **문제**  
  거래소 점검 또는 일시적인 API 장애 발생 시  
  데이터가 내려오지 않아 테이블이 비어 보이는 현상이 발생함.

- **원인**  
  실시간 API 응답에만 의존하는 구조로 인해,  
  API 실패 시 대체 데이터가 없는 상태였음.

- **해결**  
  마지막으로 정상 수신된 데이터를  
  localStorage에 저장해두고,  
  API 실패 시 이전 값을 fallback으로 렌더링하도록 처리함.

- **결과**  
  거래소 점검 상황에서도  
  테이블 구조와 데이터가 유지되어  
  사용자 경험 저하를 방지할 수 있게 됨.

---

### 6. 뉴스 페이지 폴링으로 인한 UI 상태 초기화 문제

- **문제**  
  뉴스 페이지에서 주기적 데이터 폴링으로 인해  
  “더보기”로 펼쳐둔 기사 목록이  
  데이터 갱신 시마다 초기화되는 문제가 발생함.

- **원인**  
  폴링 시 전체 데이터를 새로 렌더링하면서  
  사용자 UI 상태(expanded state)가 함께 초기화되고 있었음.

- **해결**  
  기존 데이터를 누적 저장하는 방식으로 구조를 변경하고,  
  새로 수신된 데이터만 추가하는 형태로 렌더링 로직을 개선함.

- **결과**  
  데이터 갱신이 이루어져도  
  사용자가 펼쳐둔 UI 상태가 유지되어  
  뉴스 페이지 사용성이 크게 개선됨.

---

### 7. 실시간 알림 영역 데이터 과다로 인한 가독성 문제

- **문제**  
  거래 알림 / 청산 알림 데이터가 누적되면서  
  사이드 패널의 가독성이 급격히 저하됨.

- **원인**  
  알림 데이터에 대한 최대 표시 개수 제한이 없어  
  최신 정보 파악이 어려워졌음.

- **해결**  
  알림 데이터를 최대 3건으로 제한하고,  
  매수/매도 유형에 따라 색상을 구분하여 표시함.  
  - 거래 알림: 매수(빨간색) / 매도(파란색)  
  - 청산 알림: 매수(파란색) / 매도(빨간색)

- **결과**  
  핵심 정보 위주의 알림 표시가 가능해졌고,  
  실시간 알림 영역의 가독성과 사용성이 향상됨.

---

### 8. 페이지 이동 시 사이드 패널 상태 초기화 문제

- **문제**  
  메인 페이지와 서브 페이지 간 이동 시  
  사이드 패널의 알림 데이터가 초기화되는 문제가 발생함.

- **원인**  
  페이지 이동 시 JavaScript 상태가 새로 초기화되면서  
  알림 데이터가 유지되지 않았음.

- **해결**  
  `sessionStorage`를 활용하여  
  페이지 이동 시에도 알림 데이터를 유지하도록 처리하고,  
  사이드 패널 로직을 모듈로 분리하여 재사용성을 높임.

- **결과**  
  페이지 이동 후에도  
  알림 상태가 유지되어 UX 일관성이 확보됨.   

---

### 9. 특정 모바일 환경에서 화면이 표시되지 않는 문제

- **문제**  
  일부 모바일 브라우저 환경에서  
  페이지 접속 시 테이블이 렌더링되지 않고  
  화면이 비어 보이는 현상이 발생함.  
  (시크릿 모드에서는 정상 동작)

- **원인**  
  이전 버전에서 저장된 `localStorage` 데이터와  
  현재 JavaScript 로직 간 구조 불일치로 인해  
  런타임 오류가 발생하는 경우가 있었음.  

  또한 일부 모바일 환경에서는  
  `localStorage.setItem()` 호출 시 예외가 발생할 수 있었으며,  
  해당 예외가 전체 JS 실행을 중단시키는 원인이 되었음.

- **해결**  
  1. 앱 버전 키(`kimpview:appVersion`)를 도입하여  
     버전 변경 시 `kimpview:` prefix 데이터만 자동 초기화하도록 처리함.  
  2. 모든 `localStorage.setItem()` 호출을 `try-catch`로 감싸  
     저장 실패 시에도 애플리케이션이 중단되지 않도록 방어 로직을 추가함.

- **결과**  
  기존 사용자 환경에서도 자동 복구가 가능해졌으며,  
  모바일 브라우저에서의 흰 화면 이슈가 제거됨.  
  상태 관리 안정성이 크게 향상되었고,  
  운영 환경에서의 예측 불가능한 오류 가능성을 최소화함.
---

### 10. 거래소 전환 시 김프 요약 박스가 갱신되지 않는 문제

- **문제**  
  Upbit ↔ Bithumb 전환 시 김프 요약(평균/최소/최대) 박스가 <br>이전 값으로 남거나 갱신이 지연되는 현상이 발생함.

- **원인**  
  “최근 5분 스냅샷” 기반 계산 로직이 거래소 전환 시 <br> 잔상(state/history)으로 남아 최신 데이터와 충돌했으며, <br> 비동기 갱신 타이밍에 따라 UI가 이전 값을 유지하는 경우가 있었음.

- **해결**  
  스냅샷(history) 로직을 제거하고,  현재 수신된 데이터(list) 기준으로 <br>즉시 평균/최소/최대를 계산하는 LIVE 방식으로 단순화함.

- **결과**  
  거래소 전환 시 즉시 갱신이 보장되었고, <br> 상태 관리 복잡도를 제거하여 <br>데이터 정합성 문제를 근본적으로 해결하고, <br>유지보수 효율을 극대화함.

---

## ✅ 현재 적용된 사항

### 1. 캐싱 및 데이터 구조 안정화

- Edge(Cache TTL) + Client(localStorage SWR) 이중 캐싱 전략 적용
- 데이터 성격(가격 / 환율 / 시총 / 뉴스)에 따른 TTL 분리 설계
- Stale-While-Revalidate 패턴을 적용하여 초기 체감 속도 개선
- 브라우저 저장소 버전 키 도입 (`kimpview:appVersion`) <br>
  → 구조 변경 시 자동 캐시 초기화 처리
- 모든 `localStorage.setItem()` 호출에 try-catch 적용 <br>
  → 모바일 환경 저장소 예외 발생 시 JS 중단 방지
- 거래소 전환 시 상태 충돌 제거 <br>
  → 5분 스냅샷 로직 제거 후 LIVE 재계산 구조로 단순화

- API 실패 시 마지막 정상 데이터 fallback 렌더링 <br>
  → 외부 API 장애 상황에서도 UI 유지

- state 기반 단일 데이터 소스 구조 유지 <br>
  → 필터 / 정렬 / 즐겨찾기 / 요약 지표 계산을 동일 데이터에서 파생

### 2. 배포 및 운영 환경 구성

- Cloudflare Pages + Workers 기반 분리 배포 구조 <br>
  → 정적 프론트엔드와 API Proxy 계층을 분리하여 책임 영역 명확화

- Worker 프록시를 통한 외부 API 중계 구조 설계 <br>
  → CORS 문제 해결   
  → API Key 브라우저 노출 방지   
  → 클라이언트 직접 호출 차단으로 보안 강화

- Edge 레벨 캐싱 전략 적용 <br>
  → Worker 단에서 TTL 제어로 불필요한 외부 API 호출 최소화   
  → 무료 API 크레딧 범위 내 안정적 운영

- 실서비스 트래픽 기반 구조 검증 <br>
  → 누적 방문 환경에서 요청 흐름 모니터링   
  → API 실패 / 지연 / 점검 상황 대응 구조 확립
- 클라이언트–Worker–외부 API 3단계 데이터 흐름 구조 설계

```text
Frontend(UI)
   ↓
Cloudflare Worker(Proxy + Cache + CORS)
   ↓
External APIs (거래소 / 뉴스 / 지표)
```
---
## 🚧 향후 개선 방향

- 서버 단 집계 로직 확장 (김프 과열 지표 등)
- Worker 단 캐싱 전략 고도화 및 API 장애 대응(backoff/fallback) 강화
- 데이터 품질 개선 (이상치 탐지/정합성 검증 규칙 고도화)
- 관측/모니터링 체계 추가 (에러 로깅, 실패율/지연 시간 추적)
- 사용자 트래픽 증가 대비 구조 확장성 검토



